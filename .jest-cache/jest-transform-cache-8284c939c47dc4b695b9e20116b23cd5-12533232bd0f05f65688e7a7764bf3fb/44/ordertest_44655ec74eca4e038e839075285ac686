430e78364d3772ca5c6169c16f90a26e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const route_1 = require("@/app/api/orders/route");
(0, globals_1.describe)('Order API', () => {
    (0, globals_1.beforeAll)(() => {
        // Ensure DB is not used in tests; route will fall back to static pricing
        process.env.DATABASE_URL = '';
        // Prevent actual network calls to n8n during tests
        // @ts-ignore
        global.fetch = jest.fn().mockResolvedValue({ ok: true });
    });
    (0, globals_1.it)('creates order with static pricing', async () => {
        const req = new Request('http://localhost/api/orders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                email: 'researcher@example.com',
                items: [{ slug: 'bpc-157-tb-500', quantity: 1, size: '5mg' }],
            }),
        });
        const res = await (0, route_1.POST)(req);
        (0, globals_1.expect)(res.status).toBe(200);
        const data = await res.json();
        (0, globals_1.expect)(data.success).toBe(true);
        (0, globals_1.expect)(data.totalCents).toBe(8999);
        (0, globals_1.expect)(data.persisted).toBe(false);
        (0, globals_1.expect)(data.usingDb).toBe(false);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxkcmV3cFxcT25lRHJpdmVcXERlc2t0b3BcXGluY3JlZGlibGUgcGVwdGlkZXNcXGluY3JlZGlibGUtcGVwdGlkZXNcXHRlc3RzXFxvcmRlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsMkNBQStEO0FBQy9ELGtEQUE2QztBQUU3QyxJQUFBLGtCQUFRLEVBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRTtJQUN6QixJQUFBLG1CQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IseUVBQXlFO1FBQ3pFLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQTtRQUM3QixtREFBbUQ7UUFDbkQsYUFBYTtRQUNiLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFDMUQsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFBLFlBQUUsRUFBQyxtQ0FBbUMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNqRCxNQUFNLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyw2QkFBNkIsRUFBRTtZQUNyRCxNQUFNLEVBQUUsTUFBTTtZQUNkLE9BQU8sRUFBRSxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRTtZQUMvQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDbkIsS0FBSyxFQUFFLHdCQUF3QjtnQkFDL0IsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUM7YUFDOUQsQ0FBQztTQUNILENBQUMsQ0FBQTtRQUVGLE1BQU0sR0FBRyxHQUFHLE1BQU0sSUFBQSxZQUFJLEVBQUMsR0FBRyxDQUFDLENBQUE7UUFDM0IsSUFBQSxnQkFBTSxFQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDNUIsTUFBTSxJQUFJLEdBQUcsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDN0IsSUFBQSxnQkFBTSxFQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDL0IsSUFBQSxnQkFBTSxFQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDbEMsSUFBQSxnQkFBTSxFQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbEMsSUFBQSxnQkFBTSxFQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDbEMsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGRyZXdwXFxPbmVEcml2ZVxcRGVza3RvcFxcaW5jcmVkaWJsZSBwZXB0aWRlc1xcaW5jcmVkaWJsZS1wZXB0aWRlc1xcdGVzdHNcXG9yZGVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUFsbCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnXG5pbXBvcnQgeyBQT1NUIH0gZnJvbSAnQC9hcHAvYXBpL29yZGVycy9yb3V0ZSdcblxuZGVzY3JpYmUoJ09yZGVyIEFQSScsICgpID0+IHtcbiAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAvLyBFbnN1cmUgREIgaXMgbm90IHVzZWQgaW4gdGVzdHM7IHJvdXRlIHdpbGwgZmFsbCBiYWNrIHRvIHN0YXRpYyBwcmljaW5nXG4gICAgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gJydcbiAgICAvLyBQcmV2ZW50IGFjdHVhbCBuZXR3b3JrIGNhbGxzIHRvIG44biBkdXJpbmcgdGVzdHNcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZ2xvYmFsLmZldGNoID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgb2s6IHRydWUgfSlcbiAgfSlcblxuICBpdCgnY3JlYXRlcyBvcmRlciB3aXRoIHN0YXRpYyBwcmljaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcSA9IG5ldyBSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0L2FwaS9vcmRlcnMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBlbWFpbDogJ3Jlc2VhcmNoZXJAZXhhbXBsZS5jb20nLFxuICAgICAgICBpdGVtczogW3sgc2x1ZzogJ2JwYy0xNTctdGItNTAwJywgcXVhbnRpdHk6IDEsIHNpemU6ICc1bWcnIH1dLFxuICAgICAgfSksXG4gICAgfSlcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IFBPU1QocmVxKVxuICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMClcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKVxuICAgIGV4cGVjdChkYXRhLnN1Y2Nlc3MpLnRvQmUodHJ1ZSlcbiAgICBleHBlY3QoZGF0YS50b3RhbENlbnRzKS50b0JlKDg5OTkpXG4gICAgZXhwZWN0KGRhdGEucGVyc2lzdGVkKS50b0JlKGZhbHNlKVxuICAgIGV4cGVjdChkYXRhLnVzaW5nRGIpLnRvQmUoZmFsc2UpXG4gIH0pXG59KSJdLCJ2ZXJzaW9uIjozfQ==